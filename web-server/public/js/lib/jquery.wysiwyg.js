!function(t){function e(t,i){return this instanceof e?this.init(t,i):new e(t,i)}t.fn.document=function(){var t=this.get(0);return"iframe"==t.nodeName.toLowerCase()?t.contentWindow.document:this},t.fn.documentSelection=function(){var t=this.get(0);return t.contentWindow.document.selection?t.contentWindow.document.selection.createRange().text:t.contentWindow.getSelection().toString()},t.fn.wysiwyg=function(i){if(arguments.length>0&&arguments[0].constructor==String){for(var o=arguments[0].toString(),s=[],n=1;n<arguments.length;n++)s[n-1]=arguments[n];return o in e?this.each(function(){t.data(this,"wysiwyg").designMode(),e[o].apply(this,s)}):this}var r={};if(i&&i.controls){var r=i.controls;delete i.controls}i=t.extend({html:'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">STYLE_SHEET</head><body style="margin: 0px;">INITIAL_CONTENT</body></html>',css:{},debug:!1,autoSave:!0,rmUnwantedBr:!0,brIE:!0,controls:{},messages:{}},i),i.messages=t.extend(!0,i.messages,e.MSGS_EN),i.controls=t.extend(!0,i.controls,e.TOOLBAR);for(var a in r)a in i.controls?t.extend(i.controls[a],r[a]):i.controls[a]=r[a];return this.each(function(){e(this,i)})},t.extend(e,{insertImage:function(i,o){var s=t.data(this,"wysiwyg");if(s.constructor==e&&i&&i.length>0)if(t.browser.msie&&s.focus(),o){s.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#");var n=s.getElementByAttributeValue("img","src","#jwysiwyg#");if(n){n.src=i;for(var r in o)n.setAttribute(r,o[r])}}else s.editorDoc.execCommand("insertImage",!1,i)},createLink:function(i){var o=t.data(this,"wysiwyg");if(o.constructor==e&&i&&i.length>0){var s=t(o.editor).documentSelection();s.length>0?(t.browser.msie&&o.focus(),o.editorDoc.execCommand("unlink",!1,[]),o.editorDoc.execCommand("createLink",!1,i)):o.options.messages.nonSelection&&alert(o.options.messages.nonSelection)}},insertHtml:function(i){var o=t.data(this,"wysiwyg");if(o.constructor==e&&i&&i.length>0)if(t.browser.msie){o.focus(),o.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#");var s=o.getElementByAttributeValue("img","src","#jwysiwyg#");s&&t(s).replaceWith(i)}else o.editorDoc.execCommand("insertHTML",!1,i)},setContent:function(e){var i=t.data(this,"wysiwyg");i.setContent(e),i.saveContent()},clear:function(){var e=t.data(this,"wysiwyg");e.setContent(""),e.saveContent()},MSGS_EN:{nonSelection:"select the text you wish to link"},TOOLBAR:{bold:{visible:!0,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold"},italic:{visible:!0,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic"},strikeThrough:{visible:!0,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},underline:{visible:!0,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline"},separator00:{visible:!0,separator:!0},justifyLeft:{visible:!0,css:{textAlign:"left"},tooltip:"Justify Left"},justifyCenter:{visible:!0,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyRight:{visible:!0,css:{textAlign:"right"},tooltip:"Justify Right"},justifyFull:{visible:!0,css:{textAlign:"justify"},tooltip:"Justify Full"},separator01:{visible:!0,separator:!0},indent:{visible:!0,tooltip:"Indent"},outdent:{visible:!0,tooltip:"Outdent"},separator02:{visible:!1,separator:!0},subscript:{visible:!0,tags:["sub"],tooltip:"Subscript"},superscript:{visible:!0,tags:["sup"],tooltip:"Superscript"},separator03:{visible:!0,separator:!0},undo:{visible:!0,tooltip:"Undo"},redo:{visible:!0,tooltip:"Redo"},separator04:{visible:!0,separator:!0},insertOrderedList:{visible:!0,tags:["ol"],tooltip:"Insert Ordered List"},insertUnorderedList:{visible:!0,tags:["ul"],tooltip:"Insert Unordered List"},insertHorizontalRule:{visible:!0,tags:["hr"],tooltip:"Insert Horizontal Rule"},separator05:{separator:!0},createLink:{visible:!0,exec:function(){var e=t(this.editor).documentSelection();if(e.length>0)if(t.browser.msie)this.focus(),this.editorDoc.execCommand("createLink",!0,null);else{var i=prompt("URL","http://");i&&i.length>0&&(this.editorDoc.execCommand("unlink",!1,[]),this.editorDoc.execCommand("createLink",!1,i))}else this.options.messages.nonSelection&&alert(this.options.messages.nonSelection)},tags:["a"],tooltip:"Create link"},insertImage:{visible:!0,exec:function(){if(t.browser.msie)this.focus(),this.editorDoc.execCommand("insertImage",!0,null);else{var e=prompt("URL","http://");e&&e.length>0&&this.editorDoc.execCommand("insertImage",!1,e)}},tags:["img"],tooltip:"Insert image"},separator06:{separator:!0},h1mozilla:{visible:!0&&t.browser.mozilla,className:"h1",command:"heading",arguments:["h1"],tags:["h1"],tooltip:"Header 1"},h2mozilla:{visible:!0&&t.browser.mozilla,className:"h2",command:"heading",arguments:["h2"],tags:["h2"],tooltip:"Header 2"},h3mozilla:{visible:!0&&t.browser.mozilla,className:"h3",command:"heading",arguments:["h3"],tags:["h3"],tooltip:"Header 3"},h1:{visible:!0&&!t.browser.mozilla,className:"h1",command:"formatBlock",arguments:["<H1>"],tags:["h1"],tooltip:"Header 1"},h2:{visible:!0&&!t.browser.mozilla,className:"h2",command:"formatBlock",arguments:["<H2>"],tags:["h2"],tooltip:"Header 2"},h3:{visible:!0&&!t.browser.mozilla,className:"h3",command:"formatBlock",arguments:["<H3>"],tags:["h3"],tooltip:"Header 3"},separator07:{visible:!1,separator:!0},cut:{visible:!1,tooltip:"Cut"},copy:{visible:!1,tooltip:"Copy"},paste:{visible:!1,tooltip:"Paste"},separator08:{separator:!1},increaseFontSize:{visible:!1,tags:["big"],tooltip:"Increase font size"},decreaseFontSize:{visible:!1,tags:["small"],tooltip:"Decrease font size"},separator09:{separator:!0},html:{visible:!1,exec:function(){this.viewHTML?(this.setContent(t(this.original).val()),t(this.original).hide()):(this.saveContent(),t(this.original).show()),this.viewHTML=!this.viewHTML},tooltip:"View source code"},removeFormat:{visible:!0,exec:function(){t.browser.msie&&this.focus(),this.editorDoc.execCommand("removeFormat",!1,[]),this.editorDoc.execCommand("unlink",!1,[])},tooltip:"Remove formatting"}}}),t.extend(e.prototype,{original:null,options:{},element:null,editor:null,focus:function(){t(this.editorDoc.body).focus()},init:function(e,i){var o=this;this.editor=e,this.options=i||{},t.data(e,"wysiwyg",this);var s=e.width||e.clientWidth,n=e.height||e.clientHeight;if("textarea"==e.nodeName.toLowerCase()){this.original=e,0==s&&e.cols&&(s=8*e.cols+21),0==n&&e.rows&&(n=16*e.rows+16);var r=this.editor=t('<iframe src="javascript:false;"></iframe>').css({minHeight:(n-6).toString()+"px",width:(s-0).toString()+"px"}).attr("id",t(e).attr("id")+"IFrame").attr("frameborder","0");this.editor.attr("tabindex",t(e).attr("tabindex")),t.browser.msie&&this.editor.css("height",n.toString()+"px")}var a=this.panel=t('<ul role="menu" class="panel"></ul>');this.appendControls(),this.element=t("<div></div>").css({width:s>0?s.toString()+"px":"100%"}).addClass("wysiwyg").append(a).append(t("<div><!-- --></div>").css({clear:"both"})).append(r),t(e).hide().before(this.element),this.viewHTML=!1,this.initialHeight=n-8,this.initialContent=t(e).val(),this.initFrame(),0==this.initialContent.length&&this.setContent("");var l=t(e).closest("form");this.options.autoSave&&l.submit(function(){o.saveContent()}),l.bind("reset",function(){o.setContent(o.initialContent),o.saveContent()})},initFrame:function(){var e=this,i="";this.options.css&&this.options.css.constructor==String&&(i='<link rel="stylesheet" type="text/css" media="screen" href="'+this.options.css+'" />'),this.editorDoc=t(this.editor).document(),this.editorDoc_designMode=!1;try{this.editorDoc.designMode="on",this.editorDoc_designMode=!0}catch(o){t(this.editorDoc).focus(function(){e.designMode()})}this.editorDoc.open(),this.editorDoc.write(this.options.html.replace(/INITIAL_CONTENT/,function(){return e.initialContent}).replace(/STYLE_SHEET/,function(){return i})),this.editorDoc.close(),this.editorDoc.contentEditable="true",t.browser.msie&&setTimeout(function(){t(e.editorDoc.body).css("border","none")},0),t(this.editorDoc).click(function(t){e.checkTargets(t.target?t.target:t.srcElement)}),t(this.original).focus(function(){t.browser.msie||e.focus()}),this.options.autoSave&&t(this.editorDoc).keydown(function(){e.saveContent()}).keyup(function(){e.saveContent()}).mousedown(function(){e.saveContent()}),this.options.css&&setTimeout(function(){e.options.css.constructor==String||t(e.editorDoc).find("body").css(e.options.css)},0),t(this.editorDoc).keydown(function(i){if(t.browser.msie&&e.options.brIE&&13==i.keyCode){var o=e.getRange();return o.pasteHTML("<br />"),o.collapse(!1),o.select(),!1}return!0})},designMode:function(){if(!this.editorDoc_designMode)try{this.editorDoc.designMode="on",this.editorDoc_designMode=!0}catch(t){}},getSelection:function(){return window.getSelection?window.getSelection():document.selection},getRange:function(){var t=this.getSelection();return t?t.rangeCount>0?t.getRangeAt(0):t.createRange():null},getContent:function(){return t(t(this.editor).document()).find("body").html()},setContent:function(e){t(t(this.editor).document()).find("body").html(e)},saveContent:function(){if(this.original){var e=this.getContent();this.options.rmUnwantedBr&&(e="<br>"==e.substr(-4)?e.substr(0,e.length-4):e),t(this.original).val(e)}},withoutCss:function(){if(t.browser.mozilla)try{this.editorDoc.execCommand("styleWithCSS",!1,!1)}catch(e){try{this.editorDoc.execCommand("useCSS",!1,!0)}catch(e){}}},appendMenu:function(e,i,o,s,n){var r=this;i=i||[],t("<li></li>").append(t('<a role="menuitem" tabindex="-1" href="javascript:;">'+(o||e)+"</a>").addClass(o||e).attr("title",n)).click(function(){s?s.apply(r):(r.withoutCss(),r.editorDoc.execCommand(e,!1,i)),r.options.autoSave&&r.saveContent()}).appendTo(this.panel)},appendMenuSeparator:function(){t('<li role="separator" class="separator"></li>').appendTo(this.panel)},appendControls:function(){for(var t in this.options.controls){var e=this.options.controls[t];e.separator?e.visible!==!1&&this.appendMenuSeparator():e.visible&&this.appendMenu(e.command||t,e.arguments||[],e.className||e.command||t||"empty",e.exec,e.tooltip||e.command||t||"")}},checkTargets:function(e){for(var i in this.options.controls){var o=this.options.controls[i],s=o.className||o.command||i||"empty";if(t("."+s,this.panel).removeClass("active"),o.tags){var n=e;do{if(1!=n.nodeType)break;-1!=t.inArray(n.tagName.toLowerCase(),o.tags)&&t("."+s,this.panel).addClass("active")}while(n=n.parentNode)}if(o.css){var n=t(e);do{if(1!=n[0].nodeType)break;for(var r in o.css)n.css(r).toString().toLowerCase()==o.css[r]&&t("."+s,this.panel).addClass("active")}while(n=n.parent())}}},getElementByAttributeValue:function(e,i,o){for(var s=this.editorDoc.getElementsByTagName(e),n=0;n<s.length;n++){var r=s[n].getAttribute(i);if(t.browser.msie&&(r=r.substr(r.length-o.length)),r==o)return s[n]}return!1}})}(jQuery);